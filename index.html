<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جاهزة سفرتك - أشهى الأكل البيتي | توصيل سريع</title>
    <meta name="description"
        content="اطلب أشهى الأطباق البيتية من جاهزة سفرتك. توصيل سريع وطعم البيت الأصيل في كل وجبة">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🐔</text></svg>">
</head>

<body>
    <!-- شريط التخفيضات -->
    <div class="promo-bar">
        <div class="promo-content">
            <span class="promo-icon">🎉</span>
            <span class="promo-text">توصيل مجاني للطلبات فوق 1000 جنيه | خصم 20% على الطلب الأول</span>
            <span class="promo-icon">🚚</span>
        </div>
    </div>

    <!-- الهيدر -->
    <header class="main-header">
        <div class="container">
            <div class="logo-section">
                <div class="logo">
                    <span class="logo-chicken">🐔</span>
                    <div class="logo-text">
                        <span class="logo-main">جاهزة</span>
                        <span class="logo-sub">سفرتك</span>
                    </div>
                </div>
            </div>

            <nav class="main-nav" id="mainNav">
                <ul>
                    <li><a href="#home" class="nav-link">الرئيسية</a></li>
                    <li><a href="#menu" class="nav-link">المنيو</a></li>
                    <li><a href="#offers" class="nav-link">العروض</a></li>
                    <li><a href="#about" class="nav-link">عن المطعم</a></li>
                    <li><a href="#contact" class="nav-link">تواصل</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <button class="cart-toggle" id="cartToggle">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </button>
               
            </div>
        </div>
    </header>

    <!-- القسم الرئيسي -->
    <section id="home" class="hero-section">
        <div class="hero-bg"></div>
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">
                        أشهى الأطباق البيتيّة
                        <span class="highlight">بنكهة البيت الأصيل</span>
                    </h1>
                    <p class="hero-description">
                        نقدم لك أطعم الأكلات البيتية المحضرة بحب واهتمام، مع توصيل سريع حتى باب منزلك
                    </p>
                    <div class="hero-features">
                        <div class="feature-item">
                            <i class="fas fa-clock"></i>
                            <span>توصيل خلال 30 دقيقة</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-heart"></i>
                            <span>مكونات طازجة</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-award"></i>
                            <span>جودة مضمونة</span>
                        </div>
                    </div>
                    <div class="hero-buttons">
                        <button class="btn-primary" onclick="scrollToSection('menu')">
                            <i class="fas fa-utensils"></i>
                            اطلب الآن
                        </button>
                        <button class="btn-secondary" onclick="scrollToSection('contact')">
                            <i class="fas fa-phone"></i>
                            تواصل معنا
                        </button>
                    </div>
                </div>
                <div class="hero-image">
                    <img src="https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                        alt="أطباق جاهزة سفرتك الشهية">
                </div>
            </div>
        </div>
    </section>

    <!-- قسم المنيو -->
    <section id="menu" class="menu-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">منيو اليوم</h2>
                <p class="section-subtitle">اختر من تشكيلة متنوعة من أشهى الأطباق البيتية</p>
            </div>

            <!-- فلاتر المنيو -->
            <div class="menu-filters">
                <button class="filter-btn active" data-category="all">جميع الأطباق</button>
                <button class="filter-btn" data-category="main">الأطباق الرئيسية</button>
                <button class="filter-btn" data-category="appetizers">المقبلات</button>
                <button class="filter-btn" data-category="rice">الأرز والمكرونة</button>
                <button class="filter-btn" data-category="desserts">الحلويات</button>
            </div>

            <!-- شبكة المنيو -->
            <div class="menu-grid" id="menuGrid">
                <!-- سيتم ملؤها ديناميكياً -->
            </div>
        </div>
    </section>

    <!-- قسم العروض -->
    <section id="offers" class="offers-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">العروض الخاصة</h2>
                <p class="section-subtitle">وفر أكثر مع عروضنا المميزة</p>
            </div>
            <div class="offers-grid">
                <div class="offer-card featured" data-offer="family-meal">
                    <div class="offer-badge">الأكثر طلباً</div>
                    <div class="offer-image">
                        <img src="https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
                            alt="وجبة العائلة">
                    </div>
                    <div class="offer-content">
                        <h3>وجبة العائلة الكاملة</h3>
                        <p>3 أطباق رئيسية + مقبلات + خبز + حلوى</p>
                        <div class="offer-pricing">
                            <span class="old-price">200 جنيه</span>
                            <span class="new-price">150 جنيه</span>
                        </div>
                        <button class="offer-btn" onclick="addOfferToCart('family-meal')">
                            اطلب الآن
                        </button>
                    </div>
                </div>

                <div class="offer-card" data-offer="quick-meal">
                    <div class="offer-image">
                        <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
                            alt="وجبة سريعة">
                    </div>
                    <div class="offer-content">
                        <h3>وجبة سريعة</h3>
                        <p>طبق رئيسي + مشروب + خبز</p>
                        <div class="offer-pricing">
                            <span class="old-price">75 جنيه</span>
                            <span class="new-price">60 جنيه</span>
                        </div>
                        <button class="offer-btn" onclick="addOfferToCart('quick-meal')">
                            اطلب الآن
                        </button>
                    </div>
                </div>

                <div class="offer-card" data-offer="breakfast-deal">
                    <div class="offer-image">
                        <img src="https://images.unsplash.com/photo-1571997478779-2adcbbe9ab2f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
                            alt="فطار شامي">
                    </div>
                    <div class="offer-content">
                        <h3>فطار شامي كامل</h3>
                        <p>فول + فلافل + حمص + جبنة + شاي</p>
                        <div class="offer-pricing">
                            <span class="old-price">50 جنيه</span>
                            <span class="new-price">35 جنيه</span>
                        </div>
                        <button class="offer-btn" onclick="addOfferToCart('breakfast-deal')">
                            اطلب الآن
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- قسم عن المطعم -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>عن جاهزة سفرتك</h2>
                    <p>نحن متخصصون في تحضير أشهى الأطباق البيتية التي تذكرك بطعم بيت الأهل. نستخدم أجود المكونات الطازجة
                        ونحضر كل وجبة بعناية فائقة وحب كبير.</p>
                    <div class="about-stats">
                        <div class="stat-item">
                            <div class="stat-number">50+</div>
                            <div class="stat-label">طلب يومياً</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">2000+</div>
                            <div class="stat-label">عميل راضٍ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">30</div>
                            <div class="stat-label">دقيقة توصيل</div>
                        </div>
                    </div>
                </div>
                <div class="about-image">
                    <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
                        alt="مطبخ جاهزة سفرتك">
                </div>
            </div>
        </div>
    </section>

    <!-- سلة التسوق -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>
                <i class="fas fa-shopping-cart"></i>
                سلة الطلبات
            </h3>
            <button class="cart-close" id="cartClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-body">
            <div class="cart-items" id="cartItems">
                <div class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <p>السلة فارغة</p>
                    <span>ابدأ بإضافة أطباقك المفضلة</span>
                </div>
            </div>
        </div>
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="delivery-section">
                <label for="deliveryZone">منطقة التوصيل:</label>
                <select id="deliveryZone">
                    <option value="">اختر المنطقة</option>
                    <option value="downtown" data-fee="15">وسط المدينة (15 ج)</option>
                    <option value="suburbs" data-fee="25">الضواحي (25 ج)</option>
                    <option value="outskirts" data-fee="35">الأطراف (35 ج)</option>
                </select>
            </div>
            <div class="cart-totals">
                <div class="total-line">
                    <span>المجموع الفرعي:</span>
                    <span id="subtotalAmount">0 ج</span>
                </div>
                <div class="total-line" id="discountLine" style="display: none;">
                    <span>الخصم (20%):</span>
                    <span id="discountAmount">0 ج</span>
                </div>
                <div class="total-line">
                    <span>التوصيل:</span>
                    <span id="deliveryAmount">اختر المنطقة</span>
                </div>
                <div class="total-line final-total">
                    <span>الإجمالي:</span>
                    <span id="totalAmount">0 ج</span>
                </div>
            </div>
            <button class="checkout-btn" id="checkoutBtn" disabled>
                إتمام الطلب
            </button>
        </div>
    </div>

    <!-- نافذة إتمام الطلب -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إتمام الطلب</h3>
                <button class="modal-close" onclick="closeCheckoutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="orderForm" class="order-form">
                <div class="form-section">
                    <h4><i class="fas fa-user"></i> البيانات الشخصية</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" id="customerName" placeholder="الاسم كامل" required>
                        </div>
                        <div class="form-group">
                            <input type="tel" id="customerPhone" placeholder="رقم الهاتف" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <textarea id="customerAddress" placeholder="العنوان بالتفصيل" required></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4><i class="fas fa-sticky-note"></i> ملاحظات إضافية</h4>
                    <div class="form-group">
                        <textarea id="orderNotes" placeholder="أي ملاحظات خاصة (اختياري)"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4><i class="fas fa-credit-card"></i> طريقة الدفع</h4>
                    <div class="payment-methods">
                        <label class="payment-method">
                            <input type="radio" name="paymentMethod" value="cash" checked>
                            <div class="method-content">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>كاش عند الاستلام</span>
                            </div>
                        </label>
                        <label class="payment-method">
                            <input type="radio" name="paymentMethod" value="card">
                            <div class="method-content">
                                <i class="fas fa-credit-card"></i>
                                <span>بطاقة ائتمانية</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <h4><i class="fas fa-receipt"></i> ملخص الطلب</h4>
                    <div class="order-summary" id="orderSummaryModal">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i>
                    تأكيد الطلب
                </button>
            </form>
        </div>
    </div>

    <!-- نافذة نجاح الطلب -->
    <div class="modal-overlay" id="successModal" style="display: none;">
        <div class="modal-content success-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>تم إرسال طلبك بنجاح!</h3>
            <div class="order-details">
                <p>رقم الطلب: <strong id="orderNumber"></strong></p>
                <p>سيتم التواصل معك خلال دقائق لتأكيد الطلب</p>
                <p>مدة التوصيل المتوقعة: <strong>30-45 دقيقة</strong></p>
            </div>
            <div class="success-actions">
                <button class="btn-primary" onclick="closeSuccessModal()">
                    موافق
                </button>
                <button class="btn-secondary" onclick="trackOrder()">
                    تتبع الطلب
                </button>
            </div>
        </div>
    </div>

    <!-- قسم التواصل -->
    <section id="contact" class="contact-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">تواصل معنا</h2>
                <p class="section-subtitle">نحن هنا للإجابة على جميع أسئلتك</p>
            </div>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-card">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="contact-details">
                            <h4>الهاتف</h4>
                            <p>01013577712</p>
                            <a href="tel:01013577712" class="contact-link">اتصل الآن</a>
                        </div>
                    </div>

                    <div class="contact-card">
                        <div class="contact-icon whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="contact-details">
                            <h4>واتساب</h4>
                            <p>01013407772</p>
                            <a href="https://wa.me/201013407772" target="_blank" class="contact-link">راسلنا</a>
                        </div>
                    </div>

                    <div class="contact-card">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="contact-details">
                            <h4>ساعات العمل</h4>
                            <p>يومياً من 9 ص إلى 12 م</p>
                        </div>
                    </div>

                    <div class="contact-card">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-details">
                            <h4>منطقة الخدمة</h4>
                            <p>جميع أنحاء الأسكندرية والضواحي</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- الفوتر -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <span class="logo-chicken">🐔</span>
                        <div class="logo-text">
                            <span class="logo-main">جاهزة</span>
                            <span class="logo-sub">سفرتك</span>
                        </div>
                    </div>
                    <p>نكهة البيت على سفرتك في كل وجبة</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/share/15uB4Qbmas/" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a>
                        <a href="instagram.com/sofrtk_gahza45%3Figshid%3DMzNlNGNkZWQ4Mg%3D%3D" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
                        <a href="https://wa.me/201013407772" target="_blank" rel="noopener noreferrer"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>روابط سريعة</h4>
                    <ul>
                        <li><a href="#menu">المنيو</a></li>
                        <li><a href="#offers">العروض</a></li>
                        <li><a href="#about">عن المطعم</a></li>
                        <li><a href="#contact">تواصل معنا</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>خدماتنا</h4>
                    <ul>
                        <li>توصيل سريع</li>
                        <li>أكل بيتي طازج</li>
                        <li>جودة مضمونة</li>
                        <li>خدمة عملاء متميزة</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 جاهزة سفرتك. جميع الحقوق محفوظة.</p>
                <style>
                    .meta-link {
                        text-decoration: none;
                        color: inherit;
                    }

                    .meta-link:active {
                        color: blue;
                        /* اللون الأزرق عند الضغط */
                    }
                </style>

                <p>
                    التنفيذ والتطوير
                    <a href="https://www.metasoftware.eg" class="meta-link" target="_blank" rel="noopener noreferrer">
                        Meta Software
                    </a>
                </p>

            </div>
        </div>
    </footer>

    <!-- إشعارات -->
    <div id="notifications" class="notifications-container"></div>

    <!-- تحميل السكريبتات -->
    <script src="menu-data.js"></script>
    <script src="cart-system.js"></script>
    <script src="telegram-bot.js"></script>
    <script src="main.js"></script>
        <script>
        // ===== نظام تنسيق الشاشات والواجهات الشامل =====
        class ScreenCoordinator {
            constructor() {
                this.screens = new Map();
                this.currentScreen = null;
                this.previousScreen = null;
                this.screenStack = [];
                this.transitionInProgress = false;
                this.overlays = new Map();
                this.globalState = {
                    user: null,
                    cart: null,
                    theme: 'light',
                    language: 'ar',
                    notifications: []
                };

                this.init();
            }

            // تهيئة النظام
            init() {
                this.registerScreens();
                this.setupEventListeners();
                this.initializeComponents();
                this.loadInitialScreen();

                console.log('🎬 نظام تنسيق الشاشات تم تهيئته بنجاح');
            }

            // تسجيل جميع الشاشات
            registerScreens() {
                // الشاشة الرئيسية
                this.screens.set('home', {
                    id: 'home',
                    element: document.getElementById('home'),
                    controller: new HomeScreenController(),
                    preloadData: true,
                    cacheData: true,
                    transitions: {
                        enter: 'fadeInUp',
                        exit: 'fadeOutDown'
                    }
                });

                // شاشة المنيو
                this.screens.set('menu', {
                    id: 'menu',
                    element: document.getElementById('menu'),
                    controller: new MenuScreenController(),
                    preloadData: true,
                    cacheData: true,
                    transitions: {
                        enter: 'slideInRight',
                        exit: 'slideOutLeft'
                    }
                });

                // شاشة العروض
                this.screens.set('offers', {
                    id: 'offers',
                    element: document.getElementById('offers'),
                    controller: new OffersScreenController(),
                    preloadData: false,
                    cacheData: true,
                    transitions: {
                        enter: 'bounceIn',
                        exit: 'bounceOut'
                    }
                });

                // شاشة عن المطعم
                this.screens.set('about', {
                    id: 'about',
                    element: document.getElementById('about'),
                    controller: new AboutScreenController(),
                    preloadData: false,
                    cacheData: false,
                    transitions: {
                        enter: 'zoomIn',
                        exit: 'zoomOut'
                    }
                });

                // شاشة التواصل
                this.screens.set('contact', {
                    id: 'contact',
                    element: document.getElementById('contact'),
                    controller: new ContactScreenController(),
                    preloadData: false,
                    cacheData: false,
                    transitions: {
                        enter: 'slideInUp',
                        exit: 'slideOutDown'
                    }
                });

                // النوافذ المنبثقة
                this.registerOverlays();
            }

            // تسجيل النوافذ المنبثقة
            registerOverlays() {
                this.overlays.set('cart', {
                    id: 'cart',
                    element: document.getElementById('cartSidebar'),
                    controller: new CartOverlayController(),
                    modal: false,
                    persistent: true
                });

                this.overlays.set('checkout', {
                    id: 'checkout',
                    element: document.getElementById('checkoutModal'),
                    controller: new CheckoutOverlayController(),
                    modal: true,
                    persistent: false
                });

                this.overlays.set('success', {
                    id: 'success',
                    element: document.getElementById('successModal'),
                    controller: new SuccessOverlayController(),
                    modal: true,
                    persistent: false
                });

                this.overlays.set('loading', {
                    id: 'loading',
                    element: document.getElementById('loadingScreen'),
                    controller: new LoadingOverlayController(),
                    modal: true,
                    persistent: true
                });
            }

            // إعداد مستمعي الأحداث
            setupEventListeners() {
                // التنقل بين الشاشات
                document.addEventListener('click', this.handleNavigation.bind(this));

                // أحداث لوحة المفاتيح
                document.addEventListener('keydown', this.handleKeyboard.bind(this));

                // أحداث المتصفح
                window.addEventListener('popstate', this.handleBrowserNavigation.bind(this));
                window.addEventListener('resize', this.handleResize.bind(this));

                // أحداث التمرير
                window.addEventListener('scroll', this.handleScroll.bind(this));

                // أحداث تغيير الحالة
                document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));
            }

            // تهيئة المكونات
            initializeComponents() {
                // تهيئة النوافذ المنبثقة
                this.initializeOverlays();

                // تهيئة الشاشات
                this.initializeScreens();

                // تهيئة النظام العام
                this.initializeGlobalComponents();
            }

            // تحميل الشاشة الأولى
            loadInitialScreen() {
                const hash = window.location.hash.substring(1);
                const initialScreen = hash && this.screens.has(hash) ? hash : 'home';

                this.showScreen(initialScreen, { initial: true });
            }

            // عرض شاشة معينة
            async showScreen(screenId, options = {}) {
                if (this.transitionInProgress && !options.force) {
                    console.warn('انتقال قيد التنفيذ، يرجى الانتظار');
                    return false;
                }

                const screen = this.screens.get(screenId);
                if (!screen) {
                    console.error(`الشاشة ${screenId} غير موجودة`);
                    return false;
                }

                this.transitionInProgress = true;

                try {
                    // تحديث التاريخ
                    if (!options.initial && !options.skipHistory) {
                        this.updateBrowserHistory(screenId);
                    }

                    // إخفاء الشاشة الحالية
                    if (this.currentScreen && this.currentScreen !== screenId) {
                        await this.hideScreen(this.currentScreen);
                    }

                    // تحضير الشاشة الجديدة
                    await this.prepareScreen(screen, options);

                    // عرض الشاشة الجديدة
                    await this.displayScreen(screen, options);

                    // تحديث الحالة
                    this.updateScreenState(screenId);

                    return true;

                } catch (error) {
                    console.error('خطأ في عرض الشاشة:', error);
                    return false;
                } finally {
                    this.transitionInProgress = false;
                }
            }

            // إخفاء شاشة
            async hideScreen(screenId) {
                const screen = this.screens.get(screenId);
                if (!screen || !screen.element) return;

                // تنفيذ animation الخروج
                await this.runTransition(screen.element, screen.transitions.exit);

                // إخفاء العنصر
                screen.element.style.display = 'none';

                // تنظيف الشاشة
                if (screen.controller && screen.controller.onHide) {
                    screen.controller.onHide();
                }
            }

            // تحضير الشاشة
            async prepareScreen(screen, options) {
                // تحميل البيانات إذا لزم الأمر
                if (screen.preloadData || options.forceReload) {
                    await this.loadScreenData(screen);
                }

                // تهيئة الشاشة
                if (screen.controller && screen.controller.onPrepare) {
                    await screen.controller.onPrepare(options);
                }
            }

            // عرض الشاشة
            async displayScreen(screen, options) {
                // إظهار العنصر
                screen.element.style.display = 'block';

                // تنفيذ animation الدخول
                await this.runTransition(screen.element, screen.transitions.enter);

                // تفعيل الشاشة
                if (screen.controller && screen.controller.onShow) {
                    screen.controller.onShow(options);
                }

                // تحديث التنقل
                this.updateNavigation(screen.id);
            }

            // تحديث حالة الشاشة
            updateScreenState(screenId) {
                this.previousScreen = this.currentScreen;
                this.currentScreen = screenId;

                if (this.previousScreen) {
                    this.screenStack.push(this.previousScreen);
                }

                // تحديث العنوان
                this.updatePageTitle(screenId);

                // إرسال حدث تغيير الشاشة
                this.dispatchScreenChangeEvent(screenId);
            }

            // عرض نافذة منبثقة
            async showOverlay(overlayId, data = {}) {
                const overlay = this.overlays.get(overlayId);
                if (!overlay) {
                    console.error(`النافذة ${overlayId} غير موجودة`);
                    return false;
                }

                try {
                    // تحضير النافذة
                    if (overlay.controller && overlay.controller.onPrepare) {
                        await overlay.controller.onPrepare(data);
                    }

                    // عرض النافذة
                    overlay.element.style.display = 'flex';
                    overlay.element.classList.add('active');

                    // تشغيل animation
                    await this.runTransition(overlay.element, 'fadeIn');

                    // تفعيل النافذة
                    if (overlay.controller && overlay.controller.onShow) {
                        overlay.controller.onShow(data);
                    }

                    // إدارة التركيز للنوافذ المودال
                    if (overlay.modal) {
                        this.manageFocus(overlay.element);
                        document.body.style.overflow = 'hidden';
                    }

                    return true;

                } catch (error) {
                    console.error('خطأ في عرض النافذة:', error);
                    return false;
                }
            }

            // إخفاء نافذة منبثقة
            async hideOverlay(overlayId) {
                const overlay = this.overlays.get(overlayId);
                if (!overlay) return false;

                try {
                    // تشغيل animation الإخفاء
                    await this.runTransition(overlay.element, 'fadeOut');

                    // إخفاء النافذة
                    overlay.element.style.display = 'none';
                    overlay.element.classList.remove('active');

                    // تنظيف النافذة
                    if (overlay.controller && overlay.controller.onHide) {
                        overlay.controller.onHide();
                    }

                    // استعادة التركيز
                    if (overlay.modal) {
                        document.body.style.overflow = '';
                        this.restoreFocus();
                    }

                    return true;

                } catch (error) {
                    console.error('خطأ في إخفاء النافذة:', error);
                    return false;
                }
            }

            // تشغيل الانتقالات
            async runTransition(element, transitionName) {
                return new Promise((resolve) => {
                    const duration = this.getTransitionDuration(transitionName);

                    element.classList.add(`animate-${transitionName}`);

                    setTimeout(() => {
                        element.classList.remove(`animate-${transitionName}`);
                        resolve();
                    }, duration);
                });
            }

            // الحصول على مدة الانتقال
            getTransitionDuration(transitionName) {
                const durations = {
                    'fadeIn': 300,
                    'fadeOut': 300,
                    'fadeInUp': 500,
                    'fadeOutDown': 500,
                    'slideInRight': 400,
                    'slideOutLeft': 400,
                    'slideInUp': 400,
                    'slideOutDown': 400,
                    'bounceIn': 600,
                    'bounceOut': 400,
                    'zoomIn': 300,
                    'zoomOut': 300
                };

                return durations[transitionName] || 300;
            }

            // معالجة التنقل
            handleNavigation(event) {
                const target = event.target.closest('[data-screen]');
                if (!target) return;

                event.preventDefault();
                const screenId = target.dataset.screen;
                const options = JSON.parse(target.dataset.options || '{}');

                this.showScreen(screenId, options);
            }

            // معالجة لوحة المفاتيح
            handleKeyboard(event) {
                switch (event.key) {
                    case 'Escape':
                        this.handleEscapeKey();
                        break;
                    case 'Tab':
                        this.handleTabKey(event);
                        break;
                    case 'Enter':
                        this.handleEnterKey(event);
                        break;
                }
            }

            // معالجة مفتاح Escape
            handleEscapeKey() {
                // إغلاق النوافذ المنبثقة
                for (const [id, overlay] of this.overlays) {
                    if (overlay.element.classList.contains('active') && !overlay.persistent) {
                        this.hideOverlay(id);
                        break;
                    }
                }
            }

            // معالجة التنقل في المتصفح
            handleBrowserNavigation(event) {
                const hash = window.location.hash.substring(1);
                if (hash && this.screens.has(hash)) {
                    this.showScreen(hash, { skipHistory: true });
                }
            }

            // معالجة تغيير حجم النافذة
            handleResize() {
                // إعادة حساب أحجام العناصر
                this.recalculateLayout();

                // تحديث النوافذ المنبثقة
                this.updateOverlayPositions();
            }

            // معالجة التمرير
            handleScroll() {
                const scrollTop = window.pageYOffset;

                // تحديث الهيدر
                this.updateHeaderOnScroll(scrollTop);

                // تحديث التنقل
                this.updateNavigationOnScroll(scrollTop);
            }

            // تحميل بيانات الشاشة
            async loadScreenData(screen) {
                if (!screen.controller || !screen.controller.loadData) return;

                try {
                    const data = await screen.controller.loadData();
                    screen.data = data;
                    return data;
                } catch (error) {
                    console.error(`خطأ في تحميل بيانات ${screen.id}:`, error);
                    throw error;
                }
            }

            // تحديث تاريخ المتصفح
            updateBrowserHistory(screenId) {
                const url = `#${screenId}`;
                history.pushState({ screenId }, '', url);
            }

            // تحديث عنوان الصفحة
            updatePageTitle(screenId) {
                const titles = {
                    'home': 'جاهزة سفرتك - أشهى الأكل البيتي',
                    'menu': 'المنيو - جاهزة سفرتك',
                    'offers': 'العروض الخاصة - جاهزة سفرتك',
                    'about': 'عن المطعم - جاهزة سفرتك',
                    'contact': 'تواصل معنا - جاهزة سفرتك'
                };

                document.title = titles[screenId] || 'جاهزة سفرتك';
            }

            // تحديث التنقل
            updateNavigation(screenId) {
                // إزالة الفئة النشطة من جميع الروابط
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });

                // إضافة الفئة النشطة للرابط الحالي
                const activeLink = document.querySelector(`[href="#${screenId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }

            // إرسال حدث تغيير الشاشة
            dispatchScreenChangeEvent(screenId) {
                const event = new CustomEvent('screenChanged', {
                    detail: {
                        currentScreen: screenId,
                        previousScreen: this.previousScreen,
                        timestamp: Date.now()
                    }
                });

                document.dispatchEvent(event);
            }

            // إدارة التركيز
            manageFocus(element) {
                this.lastFocusedElement = document.activeElement;

                // العثور على أول عنصر قابل للتركيز
                const focusableElements = element.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );

                if (focusableElements.length > 0) {
                    focusableElements[0].focus();
                }
            }

            // استعادة التركيز
            restoreFocus() {
                if (this.lastFocusedElement) {
                    this.lastFocusedElement.focus();
                    this.lastFocusedElement = null;
                }
            }

            // العودة للشاشة السابقة
            goBack() {
                if (this.screenStack.length > 0) {
                    const previousScreen = this.screenStack.pop();
                    this.showScreen(previousScreen);
                }
            }

            // الحصول على الشاشة الحالية
            getCurrentScreen() {
                return this.currentScreen;
            }

            // الحصول على بيانات الشاشة
            getScreenData(screenId) {
                const screen = this.screens.get(screenId);
                return screen ? screen.data : null;
            }

            // تحديث الحالة العامة
            updateGlobalState(key, value) {
                this.globalState[key] = value;

                // إشعار جميع الشاشات بالتحديث
                for (const [id, screen] of this.screens) {
                    if (screen.controller && screen.controller.onGlobalStateUpdate) {
                        screen.controller.onGlobalStateUpdate(key, value);
                    }
                }
            }

            // الحصول على الحالة العامة
            getGlobalState(key) {
                return key ? this.globalState[key] : this.globalState;
            }
        }

        // ===== تحكم في الشاشات المختلفة =====

        // تحكم الشاشة الرئيسية
        class HomeScreenController {
            async onPrepare(options) {
                console.log('🏠 تحضير الشاشة الرئيسية');
                this.loadStats();
                this.initHeroAnimations();
            }

            onShow(options) {
                console.log('🏠 عرض الشاشة الرئيسية');
                this.startCounterAnimations();
                this.trackPageView('home');
            }

            onHide() {
                console.log('🏠 إخفاء الشاشة الرئيسية');
                this.pauseAnimations();
            }

            loadStats() {
                // تحميل إحصائيات المطعم
                const stats = {
                    customers: 2000,
                    dailyOrders: 500,
                    deliveryTime: 30,
                    experience: 5
                };

                this.animateCounters(stats);
            }

            animateCounters(stats) {
                Object.keys(stats).forEach(key => {
                    const element = document.querySelector(`[data-count="${stats[key]}"]`);
                    if (element) {
                        this.animateCounter(element, stats[key]);
                    }
                });
            }

            animateCounter(element, target) {
                let current = 0;
                const increment = target / 50;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    element.textContent = Math.floor(current);
                }, 30);
            }

            trackPageView(page) {
                // تتبع زيارة الصفحة
                if (typeof gtag !== 'undefined') {
                    gtag('config', 'GA_MEASUREMENT_ID', {
                        page_title: page,
                        page_location: window.location.href
                    });
                }
            }
        }

        // تحكم شاشة المنيو
        class MenuScreenController {
            constructor() {
                this.currentFilter = 'all';
                this.menuItems = [];
                this.filteredItems = [];
            }

            async loadData() {
                if (window.menuSystem && window.menuSystem.menuData) {
                    this.menuItems = window.menuSystem.menuData;
                    return this.menuItems;
                }

                // تحميل من API إذا لزم الأمر
                return [];
            }

            async onPrepare(options) {
                console.log('🍽️ تحضير شاشة المنيو');
                await this.loadData();
                this.initializeFilters();
                this.renderMenuItems();
            }

            onShow(options) {
                console.log('🍽️ عرض شاشة المنيو');
                this.trackPageView('menu');
                this.startItemAnimations();
            }

            initializeFilters() {
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.filterMenu(e.target.dataset.category);
                    });
                });
            }

            filterMenu(category) {
                this.currentFilter = category;
                this.filteredItems = category === 'all'
                    ? this.menuItems
                    : this.menuItems.filter(item => item.category === category);

                this.renderMenuItems();
                this.updateActiveFilter(category);
            }

            renderMenuItems() {
                const grid = document.getElementById('menuGrid');
                if (!grid) return;

                grid.innerHTML = this.filteredItems.map(item =>
                    this.createMenuItemHTML(item)
                ).join('');

                this.addItemEventListeners();
            }

            createMenuItemHTML(item) {
                const rating = this.getItemRating(item.id);
                const popularBadge = item.popular ? '<div class="popular-badge">الأكثر طلباً</div>' : '';

                return `
            <div class="menu-item" data-item-id="${item.id}">
                <div class="menu-item-image">
                    <img src="${item.image}" alt="${item.name}" loading="lazy">
                    ${popularBadge}
                </div>
                <div class="menu-item-content">
                    <h3 class="menu-item-title">${item.name}</h3>
                    <p class="menu-item-description">${item.description}</p>
                    ${rating ? `<div class="item-rating">${rating}</div>` : ''}
                    <div class="menu-item-footer">
                        <span class="menu-item-price">${item.price} جنيه</span>
                        <button class="add-to-cart-btn" data-item-id="${item.id}">
                            <i class="fas fa-plus"></i>
                            إضافة
                        </button>
                    </div>
                </div>
            </div>
        `;
            }

            addItemEventListeners() {
                const addButtons = document.querySelectorAll('.add-to-cart-btn');
                addButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = e.target.dataset.itemId;
                        this.addToCart(itemId);
                    });
                });
            }

            addToCart(itemId) {
                if (window.cart) {
                    window.cart.addToCart(itemId);
                }
            }
        }

        // تحكم شاشة العروض
        class OffersScreenController {
            async onPrepare(options) {
                console.log('🎁 تحضير شاشة العروض');
                this.loadOffers();
                this.initOfferCards();
            }

            onShow(options) {
                console.log('🎁 عرض شاشة العروض');
                this.trackPageView('offers');
                this.animateOffers();
            }

            loadOffers() {
                if (window.menuSystem && window.menuSystem.specialOffers) {
                    this.offers = Object.values(window.menuSystem.specialOffers);
                }
            }

            animateOffers() {
                const offerCards = document.querySelectorAll('.offer-card');
                offerCards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 200);
                });
            }
        }

        // تحكم شاشة عن المطعم
        class AboutScreenController {
            onPrepare(options) {
                console.log('ℹ️ تحضير شاشة عن المطعم');
                this.initStatAnimations();
            }

            onShow(options) {
                console.log('ℹ️ عرض شاشة عن المطعم');
                this.trackPageView('about');
                this.startStatAnimations();
            }

            startStatAnimations() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            this.animateStats();
                            observer.disconnect();
                        }
                    });
                });

                const statsSection = document.querySelector('.about-stats');
                if (statsSection) {
                    observer.observe(statsSection);
                }
            }

            animateStats() {
                const statNumbers = document.querySelectorAll('.stat-number[data-count]');
                statNumbers.forEach(element => {
                    const target = parseInt(element.dataset.count);
                    this.animateCounter(element, target);
                });
            }

            animateCounter(element, target) {
                let current = 0;
                const increment = target / 60;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    element.textContent = Math.floor(current);
                }, 25);
            }
        }

        // تحكم شاشة التواصل
        class ContactScreenController {
            onPrepare(options) {
                console.log('📞 تحضير شاشة التواصل');
                this.initContactForm();
                this.checkWorkingHours();
            }

            onShow(options) {
                console.log('📞 عرض شاشة التواصل');
                this.trackPageView('contact');
            }

            initContactForm() {
                const form = document.getElementById('contactForm');
                if (form) {
                    form.addEventListener('submit', this.handleFormSubmit.bind(this));
                }
            }

            handleFormSubmit(event) {
                event.preventDefault();
                // معالجة إرسال النموذج
                this.showSuccessMessage();
            }

            checkWorkingHours() {
                const now = new Date();
                const hour = now.getHours();
                const isOpen = hour >= 9 && hour < 23;

                const statusElement = document.querySelector('.status.online');
                if (statusElement) {
                    statusElement.textContent = isOpen ? 'مفتوح الآن' : 'مغلق الآن';
                    statusElement.className = `status ${isOpen ? 'online' : 'offline'}`;
                }
            }
        }

        // تحكم نافذة السلة
        class CartOverlayController {
            onPrepare(data) {
                console.log('🛒 تحضير نافذة السلة');
                this.updateCartDisplay();
            }

            onShow(data) {
                console.log('🛒 عرض نافذة السلة');
                this.trackEvent('cart_opened');
            }

            onHide() {
                console.log('🛒 إخفاء نافذة السلة');
            }

            updateCartDisplay() {
                if (window.cart) {
                    window.cart.updateCartDisplay();
                }
            }
        }

        // تحكم نافذة الطلب
        class CheckoutOverlayController {
            onPrepare(data) {
                console.log('💳 تحضير نافذة الطلب');
                this.populateOrderSummary();
                this.initFormValidation();
            }

            onShow(data) {
                console.log('💳 عرض نافذة الطلب');
                this.trackEvent('checkout_started');
            }

            populateOrderSummary() {
                if (window.cart) {
                    window.cart.populateCheckoutSummary();
                }
            }
        }

        // تحكم نافذة النجاح
        class SuccessOverlayController {
            onPrepare(data) {
                console.log('✅ تحضير نافذة النجاح');
                this.setupSuccessData(data);
            }

            onShow(data) {
                console.log('✅ عرض نافذة النجاح');
                this.trackEvent('order_completed');
                this.startConfetti();
            }

            setupSuccessData(data) {
                if (data.orderNumber) {
                    const orderNumberElement = document.getElementById('orderNumber');
                    if (orderNumberElement) {
                        orderNumberElement.textContent = data.orderNumber;
                    }
                }
            }

            startConfetti() {
                // تأثير الاحتفال
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            }
        }

        // تحكم شاشة التحميل
        class LoadingOverlayController {
            onShow(data) {
                console.log('⏳ عرض شاشة التحميل');
                this.startLoadingAnimation();
            }

            onHide() {
                console.log('⏳ إخفاء شاشة التحميل');
                this.stopLoadingAnimation();
            }

            startLoadingAnimation() {
                const spinner = document.querySelector('.loading-spinner');
                if (spinner) {
                    spinner.style.animation = 'spin 1s linear infinite';
                }
            }

            stopLoadingAnimation() {
                const spinner = document.querySelector('.loading-spinner');
                if (spinner) {
                    spinner.style.animation = 'none';
                }
            }
        }

        // ===== الوظائف العامة =====

        // إنشاء نسخة عامة من منسق الشاشات
        const screenCoordinator = new ScreenCoordinator();

        // وظائف عامة للاستخدام
        function showScreen(screenId, options = {}) {
            return screenCoordinator.showScreen(screenId, options);
        }

        function showOverlay(overlayId, data = {}) {
            return screenCoordinator.showOverlay(overlayId, data);
        }

        function hideOverlay(overlayId) {
            return screenCoordinator.hideOverlay(overlayId);
        }

        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                const headerHeight = 80;
                const targetPosition = section.offsetTop - headerHeight;

                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });

                // تحديث الحالة
                screenCoordinator.showScreen(sectionId, { skipAnimation: true });
            }
        }

        function closeCheckoutModal() {
            hideOverlay('checkout');
        }

        function closeSuccessModal() {
            hideOverlay('success');
        }

        function trackOrder() {
            const orderNumber = document.getElementById('orderNumber')?.textContent;
            if (orderNumber) {
                window.open(`#track-order?order=${orderNumber}`, '_blank');
            }
        }

        // تصدير للاستخدام العام
        if (typeof window !== 'undefined') {
            window.screenCoordinator = screenCoordinator;
            window.showScreen = showScreen;
            window.showOverlay = showOverlay;
            window.hideOverlay = hideOverlay;
            window.scrollToSection = scrollToSection;
        }

        // تهيئة النظام عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🚀 نظام تنسيق الشاشات جاهز للعمل');

            // إخفاء شاشة التحميل بعد التهيئة
            setTimeout(() => {
                hideOverlay('loading');
            }, 2000);
        });

        console.log('🎬 تم تحميل نظام تنسيق الشاشات بنجاح');

    </script>
</body>


</html>

